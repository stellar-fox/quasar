<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <script type="text/javascript" src="cordova.js"></script>
        <script>
            var httpd = null;
            function onLoad() {
                document.addEventListener("deviceready", onDeviceReady, false);
                document.getElementById('url').innerHTML = "server is starting.";
                setTimeout(updateStatus(), 2000);
            }

            function onDeviceReady() {
                httpd = ( cordova && cordova.plugins && cordova.plugins.CorHttpd ) ? cordova.plugins.CorHttpd : null;
                startServer("htdocs")
            }

            function updateStatus() {
                if( httpd ) {
                    httpd.getURL(function(url){
                        if(url.length > 0) {
                            document.getElementById('url').innerHTML = '<object width="100%" height="100%" type="text/html" data="' + url + '" ></object>';
                        } else {
                            document.getElementById('url').innerHTML = "server is down.";
                        }
                    });
                } else {
                    document.getElementById('url').innerHTML = '[updateStatus] CorHttpd plugin not available/ready.';
                }
            }
            function startServer( wwwroot ) {
                if ( httpd ) {
                    httpd.getURL(function(url){
                        if(url.length > 0) {
                        document.getElementById('url').innerHTML = '<object width="100%" height="100%" type="text/html" data="' + url + '" ></object>';
                            } else {
                            httpd.startServer({
                                'www_root' : wwwroot,
                                'port' : 8080
                            }, function( url ){
                                updateStatus();
                            }, function( error ){
                                document.getElementById('url').innerHTML = 'failed to start server: ' + error;
                            });
                        }
                        
                    },function(){});
                } else {
                    document.getElementById('url').innerHTML = '[startServer] CorHttpd plugin not available/ready.';
                }
            }
            function stopServer() {
                if ( httpd ) {
                    httpd.stopServer(function(){
                        updateStatus();
                    },function( error ){
                        document.getElementById('url').innerHTML = 'failed to stop server' + error;
                    });
                } else {
                    alert('CorHttpd plugin not available/ready.');
                }
            }
        </script>
        <style type="text/css">
            html, body { width:100%; height:100%; margin:0; padding:0; overflow:hidden; background-color:white; }
            div#url { width:100%; height:100%; margin:0; padding:0; border:0px solid red; text-align:center; vertical-align:middle; }
        </style>
    </head>
    <body onload="onLoad()">
    <div id='url'></div>
    </div>
    
    </body>
</html>
